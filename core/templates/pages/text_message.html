{% extends "layouts/chat.html" %}

{% block title %} Forms {% endblock title %}

{% block layout %} sidebar_minimize {% endblock layout %}


<!-- Specific CSS goes HERE -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}
    <!-- 
    
    A concept for a chat interface. 
    
    Try writing a new message! :)
    
    
    Follow me here:
    Twitter: https://twitter.com/thatguyemil
    Codepen: https://codepen.io/emilcarlsson/
    Website: http://emilcarlsson.se/
    
    -->
        <div id="allData" data="{{allContacts}}"></div>

        <div class="centerit">
            <div class="chat-container">
                <aside>
                    <div class="top-bar">
                        <form action="" method="post" id="addSubmit">
                            {% csrf_token %}
                            <input type="text" style="display: none;" name="keyInput" id="key">
                            <input type="text" style="display: none;" name="invite" id="invite">
                            <input type="text" style="display:none;" id="person1" name="person1">
                            <div class="row">
                                <div class="col-md-4">
                                    <button class="new-conversation" type="button" id="alert_demo_5" style="float:center;">Join</button>
                                </div>
                                <div class="col-md-4">
                                    <button class="new-conversation" type="submit" id="alert_demo_4" name="create" value="on" style="float:center;">Create</button>
                                </div>
                                <div class="col-md-4">
                                    <button class="new-conversation ml-2" type="button" id="alert_demo_3" name="create" value="on"
                                        style="float:center;">Invite</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="conversations">
                        {% for chatID, contactList, messages, profile, lastMessageList in zippedData %}
                            <a class="tablinks" onclick="openCity(event, '{{forloop.counter}}')" number="{{forloop.counter}}">
                                <div class="thread">
                                    <div class="details">
                                        {% if profile.1 == True %}
                                            <div class="user-head online">
                                                <img src="../media/{{profile.0}}">
                                            </div>
                                        {% else %}
                                            <div class="user-head away">
                                                <img src="../media/{{profile.0}}">
                                            </div>
                                        {% endif %}
                                        {% if contactList|length != 1 %}
                                            {% for contact in contactList %}
                                                {% if contact != user.get_username %}
                                                    <div class="user-name">{{contact}}</div>
                                                {% endif %}
                                            {% endfor %}
                                        {% else %}
                                            <div class="user-name">You Are The ONLY One</div>
                                        {% endif %}
                                        <div class="last-message">{{lastMessageList.0}}</div>
                                    </div>
                                </div>
                            </a>
                        {% endfor %}
                       
                    </div>
                </aside>
                <main>
                    <div class="top-bar">
                        <div class="user-info">
                            <div class="user-head">
                                <img src="../media/{{myProfile}}">
                            </div>
                            <div class="name">{{user.get_username}}</div>
                            <div class="status online"></div>
                        </div>
                        <div class="buttons">
                            <div class="call">
                                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                                    x="0px" y="0px" viewBox="0 0 512.076 512.076"
                                    style="enable-background:new 0 0 512.076 512.076;" xml:space="preserve">
                                    <g>
                                        <path
                                            d="M499.639,396.039l-103.646-69.12c-13.153-8.701-30.784-5.838-40.508,6.579l-30.191,38.818
                                     c-3.88,5.116-10.933,6.6-16.546,3.482l-5.743-3.166c-19.038-10.377-42.726-23.296-90.453-71.04s-60.672-71.45-71.049-90.453
                                     l-3.149-5.743c-3.161-5.612-1.705-12.695,3.413-16.606l38.792-30.182c12.412-9.725,15.279-27.351,6.588-40.508l-69.12-103.646
                                     C109.12,1.056,91.25-2.966,77.461,5.323L34.12,31.358C20.502,39.364,10.511,52.33,6.242,67.539
                                     c-15.607,56.866-3.866,155.008,140.706,299.597c115.004,114.995,200.619,145.92,259.465,145.92
                                     c13.543,0.058,27.033-1.704,40.107-5.239c15.212-4.264,28.18-14.256,36.181-27.878l26.061-43.315
                                     C517.063,422.832,513.043,404.951,499.639,396.039z M494.058,427.868l-26.001,43.341c-5.745,9.832-15.072,17.061-26.027,20.173
                                     c-52.497,14.413-144.213,2.475-283.008-136.32S8.29,124.559,22.703,72.054c3.116-10.968,10.354-20.307,20.198-26.061
                                     l43.341-26.001c5.983-3.6,13.739-1.855,17.604,3.959l37.547,56.371l31.514,47.266c3.774,5.707,2.534,13.356-2.85,17.579
                                     l-38.801,30.182c-11.808,9.029-15.18,25.366-7.91,38.332l3.081,5.598c10.906,20.002,24.465,44.885,73.967,94.379
                                     c49.502,49.493,74.377,63.053,94.37,73.958l5.606,3.089c12.965,7.269,29.303,3.898,38.332-7.91l30.182-38.801
                                     c4.224-5.381,11.87-6.62,17.579-2.85l103.637,69.12C495.918,414.126,497.663,421.886,494.058,427.868z" />
                                        <path
                                            d="M291.161,86.39c80.081,0.089,144.977,64.986,145.067,145.067c0,4.713,3.82,8.533,8.533,8.533s8.533-3.82,8.533-8.533
                                     c-0.099-89.503-72.63-162.035-162.133-162.133c-4.713,0-8.533,3.82-8.533,8.533S286.448,86.39,291.161,86.39z" />
                                        <path d="M291.161,137.59c51.816,0.061,93.806,42.051,93.867,93.867c0,4.713,3.821,8.533,8.533,8.533
                                     c4.713,0,8.533-3.82,8.533-8.533c-0.071-61.238-49.696-110.863-110.933-110.933c-4.713,0-8.533,3.82-8.533,8.533
                                     S286.448,137.59,291.161,137.59z" />
                                        <path
                                            d="M291.161,188.79c23.552,0.028,42.638,19.114,42.667,42.667c0,4.713,3.821,8.533,8.533,8.533s8.533-3.82,8.533-8.533
                                     c-0.038-32.974-26.759-59.696-59.733-59.733c-4.713,0-8.533,3.82-8.533,8.533S286.448,188.79,291.161,188.79z" />
                                    </g>
                                </svg>
                            </div>
                        </div>
                    </div>
                    {% for chatID, contactList, messages, profile, lastMessageList in zippedData %}
                        <div class="messages" id="{{forloop.counter}}">
                            
                            {% for message in messages %}
                                {% if message.user != user.get_username %}
                                    <div class="message">
                                        <div class="user-head">
                                            <img src="../media/{{profile.0}}">
                                        </div>
                                        <div class="content">{{message.content.1}}</div>
                                    </div>
                                {% else %}
                                    <div class="message fromme">
                                        <div class="user-head online">
                                            <img src="../media/{{myProfile}}">
                                        </div>
                                        <div class="content">{{message.content.1}}</div>
                                       
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    {% endfor %}
                    <form method="post">
                        {% csrf_token %}
                        <div class="bottom-bar">
                            <textarea class="msg-input" name="message" placeholder="New Message" style="resize: none;"></textarea>
                            <input type="text" style="display:none;" id="person" name="person">
                            <button class="btn btn-danger mr-5" type="submit">Send</button>
                        </div>
                    </form>
                </main>
                
            </div>
        </div>

    
{% endblock content %}

<!-- Specific JS goes HERE -->
{% block javascripts %}
<script>
    $('.chat-container').scrollTop($('.chat-container')[0].scrollHeight);

    $("[number='1']").click(function () {
        if (null == this.ran) {
            this.ran = true;
        }
    })
    var allContacts = eval(document.getElementById('allData').getAttribute('data'));
    console.log(allContacts);
    function sleep(time) {
        return new Promise((resolve) => setTimeout(resolve, time));
    }

    var SweetAlert2Demo = function () {
        //== Demos
        var initDemos = function () {
            //== Sweetalert Demo 1
            $('#alert_demo_3').click(function (e) {
                swal({
                    title: 'Username:',
                    html: '<br><input class="form-control" placeholder="Input Something" id="input-field">',
                    content: {
                        element: "input",
                        attributes: {
                            placeholder: "Username",
                            type: "text",
                            id: "input-field",
                            className: "form-control"
                        }
                    },
                    buttons: {
                        cancel: {
                            visible: true,
                            className: 'btn btn-danger'
                        },
                        confirm: {
                            className: 'btn btn-success',
                        },
                        allowOutsideClick: false

                    },
                }).then(
                    function () {
                        sleep(2000).then(() => {
                            document.getElementById('invite').value = $('#input-field').val();
                            document.getElementById("addSubmit").submit();
                        })
                    }
                );
            });
            $('#alert_demo_5').click(function (e) {
                swal({
                    title: 'Enter Chat ID',
                    html: '<br><input class="form-control" placeholder="Input Something" id="input-field">',
                    content: {
                        element: "input",
                        attributes: {
                            placeholder: "Enter Chat ID",
                            type: "text",
                            id: "input-field",
                            className: "form-control"
                        }
                    },
                    buttons: {
                        cancel: {
                            visible: true,
                            className: 'btn btn-danger'
                        },
                        confirm: {
                            className: 'btn btn-success',
                        },
                        allowOutsideClick: false

                    },
                }).then(
                    function () {
                        sleep(2000).then(() => {
                            document.getElementById('key').value = $('#input-field').val();
                            document.getElementById("addSubmit").submit();                     
                        })
                    }
                );
            });
        };

        return {
            //== Init
            init: function () {
                initDemos();
            },
        };
    }();
    jQuery(document).ready(function () {
        SweetAlert2Demo.init();
    });
    openCity(event, '1')
    function openCity(evt, cityName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("messages");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(cityName).style.display = "block";
        evt.currentTarget.className += " active";
        
        document.getElementById('person').value = allContacts[cityName-1];
        document.getElementById('person1').value = allContacts[cityName - 1];
    }
    //== Class Initialization
    
</script>
{% endblock javascripts %}